<!DOCTYPE html>
<html>
<head>
    <title>Тест API загрузки данных</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Тест API для загрузки сотрудников и проектов</h1>
    
    <button onclick="testEmployees()">Тест загрузки сотрудников</button>
    <button onclick="testProjects()">Тест загрузки проектов</button>
    <button onclick="testAuth()">Тест аутентификации</button>
    
    <div id="results" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; white-space: pre-line;"></div>

    <script>
        // Функция для добавления результата
        function addResult(text) {
            const results = document.getElementById('results');
            results.textContent += new Date().toLocaleTimeString() + ': ' + text + '\n';
        }

        // Тест аутентификации
        function testAuth() {
            addResult('Проверка аутентификации...');
            
            fetch('/api/test-auth', {
                method: 'GET',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                },
                credentials: 'same-origin'
            })
            .then(response => {
                addResult('Auth response status: ' + response.status);
                return response.json();
            })
            .then(data => {
                addResult('Auth data: ' + JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('Auth error: ' + error.message);
            });
        }

        // Тест загрузки сотрудников
        function testEmployees() {
            addResult('Тестирование загрузки сотрудников...');
            
            fetch('/api/partner/document-templates/employees', {
                method: 'GET',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                addResult('Employees response status: ' + response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                addResult('Employees data: ' + JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('Employees error: ' + error.message);
            });
        }

        // Тест загрузки проектов
        function testProjects() {
            addResult('Тестирование загрузки проектов...');
            
            fetch('/api/partner/document-templates/projects', {
                method: 'GET',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                addResult('Projects response status: ' + response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                addResult('Projects data: ' + JSON.stringify(data, null, 2));
            })
            .catch(error => {
                addResult('Projects error: ' + error.message);
            });
        }

        // Устанавливаем CSRF токен если он не установлен
        if (!document.querySelector('meta[name="csrf-token"]')) {
            const meta = document.createElement('meta');
            meta.name = 'csrf-token';
            meta.content = 'test-token'; // Это не будет работать, но покажет проблему
            document.head.appendChild(meta);
        }
    </script>
</body>
</html>
