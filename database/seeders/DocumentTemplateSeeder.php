<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\DocumentTemplate;
use App\Models\User;

class DocumentTemplateSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Получаем первого админа для создания шаблонов
        $admin = User::first();
        
        if (!$admin) {
            $this->command->error('Не найден пользователь для создания шаблонов');
            return;
        }

        // Шаблон 1: Договор на строительные работы
        DocumentTemplate::create([
            'name' => 'Договор на строительные работы',
            'description' => 'Универсальный шаблон договора для строительных и ремонтных работ',
            'document_type' => 'contract',
            'template_content' => $this->getContractTemplate(),
            'variables' => [
                'contract_number', 'contract_date', 'client_name', 'client_phone', 
                'object_address', 'work_description', 'start_date', 'end_date', 
                'total_cost', 'payment_terms'
            ],
            'created_by' => $admin->id,
            'is_active' => true,
        ]);

        // Шаблон 2: Акт выполненных работ
        DocumentTemplate::create([
            'name' => 'Акт выполненных работ',
            'description' => 'Акт приемки-передачи выполненных строительных работ',
            'document_type' => 'act',
            'template_content' => $this->getActTemplate(),
            'variables' => [
                'act_number', 'act_date', 'contract_number', 'contract_date',
                'client_name', 'object_address', 'work_description', 
                'work_period_start', 'work_period_end', 'total_cost'
            ],
            'created_by' => $admin->id,
            'is_active' => true,
        ]);

        $this->command->info('Созданы шаблоны документов: Договор и Акт выполненных работ');
    }

    /**
     * Шаблон договора на строительные работы
     */
    private function getContractTemplate(): string
    {
        return <<<'EOT'
ДОГОВОР НА ВЫПОЛНЕНИЕ СТРОИТЕЛЬНЫХ РАБОТ
№ {{contract_number}} от {{contract_date}}

г. Москва

Общество с ограниченной ответственностью "РЕМ", именуемое в дальнейшем "Подрядчик", в лице директора, действующего на основании Устава, с одной стороны, и {{client_name}}, именуемый(ая) в дальнейшем "Заказчик", с другой стороны, заключили настоящий договор о нижеследующем:

1. ПРЕДМЕТ ДОГОВОРА

1.1. Подрядчик обязуется выполнить следующие строительные работы:
{{work_description}}

1.2. Адрес объекта: {{object_address}}

1.3. Контактный телефон Заказчика: {{client_phone}}

2. СРОКИ ВЫПОЛНЕНИЯ РАБОТ

2.1. Начало работ: {{start_date}}
2.2. Окончание работ: {{end_date}}

3. СТОИМОСТЬ РАБОТ И ПОРЯДОК РАСЧЕТОВ

3.1. Общая стоимость работ составляет: {{total_cost}} (прописью) рублей.
3.2. Порядок оплаты: {{payment_terms}}

4. ПРАВА И ОБЯЗАННОСТИ СТОРОН

4.1. Подрядчик обязуется:
- Выполнить работы качественно и в срок
- Использовать материалы надлежащего качества
- Обеспечить безопасность проведения работ
- Устранить выявленные недостатки в течение гарантийного срока

4.2. Заказчик обязуется:
- Произвести оплату в соответствии с условиями договора
- Обеспечить доступ к объекту работ
- Принять выполненные работы

5. ОТВЕТСТВЕННОСТЬ СТОРОН

5.1. За нарушение сроков выполнения работ Подрядчик уплачивает неустойку в размере 0,1% от стоимости работ за каждый день просрочки.
5.2. За просрочку оплаты Заказчик уплачивает неустойку в размере 0,1% от суммы просроченного платежа за каждый день просрочки.

6. ГАРАНТИИ

6.1. Подрядчик предоставляет гарантию на выполненные работы сроком 12 месяцев с момента подписания акта выполненных работ.

7. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

7.1. Договор вступает в силу с момента подписания и действует до полного исполнения обязательств сторонами.
7.2. Все изменения и дополнения к договору оформляются письменно.

ПОДПИСИ СТОРОН:

Подрядчик:                          Заказчик:
ООО "РЕМ"                          {{client_name}}

___________________                 ___________________

М.П.                               Дата: ___________
EOT;
    }

    /**
     * Шаблон акта выполненных работ
     */
    private function getActTemplate(): string
    {
        return <<<'EOT'
АКТ ВЫПОЛНЕННЫХ РАБОТ
№ {{act_number}} от {{act_date}}

г. Москва

По договору № {{contract_number}} от {{contract_date}}

Мы, нижеподписавшиеся, представитель Подрядчика ООО "РЕМ", с одной стороны, и Заказчик {{client_name}}, с другой стороны, составили настоящий акт о том, что:

1. ИНФОРМАЦИЯ ОБ ОБЪЕКТЕ

Адрес объекта: {{object_address}}

2. ВЫПОЛНЕННЫЕ РАБОТЫ

В период с {{work_period_start}} по {{work_period_end}} выполнены следующие работы:

{{work_description}}

3. СТОИМОСТЬ ВЫПОЛНЕННЫХ РАБОТ

Общая стоимость выполненных работ составляет: {{total_cost}} (прописью) рублей.

4. ЗАКЛЮЧЕНИЕ

Работы выполнены полностью, в соответствии с техническими требованиями и договором. Качество работ соответствует установленным стандартам.

Заказчик претензий к качеству и объему выполненных работ не имеет.

ПОДПИСИ СТОРОН:

Работы выполнил:                    Работы принял:
Подрядчик ООО "РЕМ"                Заказчик {{client_name}}

___________________                 ___________________

М.П.                               Дата: {{act_date}}

РЕЗУЛЬТАТ ПРИЕМКИ: Работы выполнены полностью и приняты без замечаний.
EOT;
    }
}
