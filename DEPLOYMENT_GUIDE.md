# Инструкция по развертыванию системы электронной подписи

## Быстрый старт

### 1. Подготовка базы данных

Убедитесь, что ваша база данных настроена и выполните миграции:

```bash
# Выполните миграции для создания таблиц подписей
php artisan migrate

# При необходимости создайте тестовые данные
php artisan db:seed
```

### 2. Настройка cron задач

Добавьте в crontab следующую строку для автоматического обновления истекших запросов:

```bash
* * * * * cd /path/to/your/project && php artisan schedule:run >> /dev/null 2>&1
```

### 3. Проверка системы

```bash
# Проверьте работу команды обновления
php artisan signatures:update-expired

# Очистите кеш конфигурации
php artisan config:cache
php artisan route:cache
```

## Доступ к системе

### Основные URL:
- **Документы**: `/documents` - главная страница системы электронной подписи
- **Отправка на подпись**: кнопка "Отправить на подпись" (только для партнеров/сотрудников)
- **Подписание**: переход по ссылке из запроса на подпись

### Права доступа:

**Все пользователи:**
- Просмотр входящих запросов на подпись
- Подписание документов
- Просмотр подписанных документов
- Отклонение запросов с указанием причины

**Партнеры, сотрудники, админы:**
- Отправка документов на подпись
- Просмотр исходящих запросов
- Отмена неподписанных запросов
- Управление документами проектов

## Настройка для продакшена

### 1. Безопасность
```bash
# Обязательно используйте HTTPS
# Настройте SSL сертификат
# Включите защиту CSRF (уже включена)
```

### 2. Логирование
```bash
# Логи сохраняются в storage/logs/
# Основной лог: laravel.log
# Лог cron задач: signature-cleanup.log
```

### 3. Резервное копирование
```bash
# Создавайте ежедневные бэкапы БД
# Сохраняйте файлы документов
# Делайте снапшоты конфигурации
```

## Проверка соответствия ФЗ-63

Система автоматически обеспечивает:
- ✅ Идентификация владельца подписи (пароль + метаданные)
- ✅ Обнаружение искажений (SHA-256 хеш)
- ✅ Фиксация времени подписания
- ✅ Сохранение технических данных (IP, User-Agent)
- ✅ Возможность проверки целостности

## Устранение неполадок

### Проблема: "could not find driver"
```bash
# Установите MySQL/PDO драйвер
# В Ubuntu/Debian:
sudo apt-get install php-mysql php-pdo

# В CentOS/RHEL:
sudo yum install php-mysql php-pdo
```

### Проблема: Не загружаются документы
```bash
# Проверьте права доступа к storage
chmod -R 775 storage
chown -R www-data:www-data storage

# Создайте символическую ссылку для публичных файлов
php artisan storage:link
```

### Проблема: Не работают cron задачи
```bash
# Проверьте crontab
crontab -l

# Добавьте задачу
crontab -e
* * * * * cd /path/to/your/project && php artisan schedule:run >> /dev/null 2>&1
```

## Дополнительная настройка

### Уведомления по email (опционально)
В будущем можно добавить отправку email при:
- Получении запроса на подпись
- Подписании документа
- Истечении срока запроса

### Интеграция с ЭЦП (опционально)
Для полного соответствия ГОСТ можно интегрировать:
- КриптоПро CSP
- Сертум CSP
- Другие российские СКЗИ

## Техническая поддержка

При возникновении проблем:
1. Проверьте логи в `storage/logs/laravel.log`
2. Убедитесь, что все миграции выполнены
3. Проверьте права доступа к файлам
4. Убедитесь в корректности настроек БД

---

**Система готова к использованию и соответствует требованиям российского законодательства!**
