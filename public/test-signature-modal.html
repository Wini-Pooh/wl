<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест модального окна отправки на подпись</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <meta name="csrf-token" content="test-token">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <h1 class="mb-4">
                    <i class="bi bi-send me-2"></i>
                    Тест модального окна отправки документов на подпись
                </h1>
                
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Информация:</strong> Эта страница предназначена для тестирования модального окна отправки документов на электронную подпись с полным автозаполнением данных.
                </div>

                <!-- Демо карточки документов -->
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>
                                    Договор строительных работ
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Договор на выполнение строительно-монтажных работ по адресу г. Москва, ул. Тверская, д. 10</p>
                                <p class="text-muted small">
                                    <i class="bi bi-calendar3 me-1"></i>
                                    Создан: 21.01.2025 14:30
                                </p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="openSignatureModalForDocument(1, 'Договор строительных работ №2025-001.pdf')">
                                        <i class="bi bi-send me-1"></i>
                                        Отправить на подпись
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-download me-1"></i>
                                        Скачать
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-file-earmark-check me-2"></i>
                                    Акт выполненных работ
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Акт приемки выполненных строительных работ по объекту "Реконструкция здания"</p>
                                <p class="text-muted small">
                                    <i class="bi bi-calendar3 me-1"></i>
                                    Создан: 21.01.2025 16:45
                                </p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="openSignatureModalForDocument(2, 'Акт выполненных работ №АВР-2025-001.pdf')">
                                        <i class="bi bi-send me-1"></i>
                                        Отправить на подпись
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-download me-1"></i>
                                        Скачать
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">
                                    <i class="bi bi-file-earmark-text me-2"></i>
                                    Техническое задание
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Техническое задание на выполнение проектных работ</p>
                                <p class="text-muted small">
                                    <i class="bi bi-calendar3 me-1"></i>
                                    Создан: 21.01.2025 10:15
                                </p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="openSignatureModalForDocument(3, 'Техническое задание ТЗ-2025-001.pdf')">
                                        <i class="bi bi-send me-1"></i>
                                        Отправить на подпись
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-download me-1"></i>
                                        Скачать
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-file-earmark-spreadsheet me-2"></i>
                                    Смета на работы
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Сметный расчет стоимости строительных работ</p>
                                <p class="text-muted small">
                                    <i class="bi bi-calendar3 me-1"></i>
                                    Создан: 20.01.2025 18:20
                                </p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="openSignatureModalForDocument(4, 'Смета на работы СМ-2025-001.xlsx')">
                                        <i class="bi bi-send me-1"></i>
                                        Отправить на подпись
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-download me-1"></i>
                                        Скачать
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Кнопка для создания нового документа из шаблона -->
                <div class="card mt-4">
                    <div class="card-body text-center">
                        <h5 class="card-title">
                            <i class="bi bi-file-earmark-plus me-2"></i>
                            Создать документ из шаблона
                        </h5>
                        <p class="text-muted">Выберите готовый шаблон документа для создания</p>
                        <div class="row">
                            <div class="col-md-2">
                                <button class="btn btn-outline-primary w-100 mb-2" onclick="useTemplate('construction_contract')">
                                    <i class="bi bi-file-earmark me-1"></i>
                                    Договор
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-success w-100 mb-2" onclick="useTemplate('work_acceptance_act')">
                                    <i class="bi bi-file-earmark-check me-1"></i>
                                    Акт работ
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-info w-100 mb-2" onclick="useTemplate('work_estimate')">
                                    <i class="bi bi-file-earmark-spreadsheet me-1"></i>
                                    Смета
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-warning w-100 mb-2" onclick="useTemplate('technical_specification')">
                                    <i class="bi bi-gear me-1"></i>
                                    Тех. задание
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-secondary w-100 mb-2" onclick="useTemplate('material_specification')">
                                    <i class="bi bi-list-ul me-1"></i>
                                    Спецификация
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-dark w-100 mb-2" onclick="useTemplate('handover_protocol')">
                                    <i class="bi bi-clipboard-check me-1"></i>
                                    Протокол
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Информация о функционале -->
                <div class="mt-5">
                    <h3>
                        <i class="bi bi-check-circle me-2 text-success"></i>
                        Реализованный функционал
                    </h3>
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="text-primary">
                                <i class="bi bi-magic me-1"></i>
                                Автозаполнение данных
                            </h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-check text-success me-2"></i>Выбор проекта для автозаполнения данных клиента и объекта</li>
                                <li><i class="bi bi-check text-success me-2"></i>Выбор сотрудника для автозаполнения данных исполнителя</li>
                                <li><i class="bi bi-check text-success me-2"></i>Автоматическое заполнение сообщения получателю</li>
                                <li><i class="bi bi-check text-success me-2"></i>Визуальные индикаторы автозаполненных полей</li>
                                <li><i class="bi bi-check text-success me-2"></i>Статус автозаполнения с деталями</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5 class="text-info">
                                <i class="bi bi-shield-check me-1"></i>
                                Электронная подпись (ФЗ-63)
                            </h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-check text-success me-2"></i>Простая электронная подпись</li>
                                <li><i class="bi bi-check text-success me-2"></i>Выбор получателя из списка сотрудников</li>
                                <li><i class="bi bi-check text-success me-2"></i>Установка срока действия запроса</li>
                                <li><i class="bi bi-check text-success me-2"></i>Сообщение для получателя (до 1000 символов)</li>
                                <li><i class="bi bi-check text-success me-2"></i>Юридическая сила документов</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h5 class="text-warning">
                                <i class="bi bi-ui-radios me-1"></i>
                                Интерфейс и управление
                            </h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-check text-success me-2"></i>Модальное окно XL размера с адаптивным дизайном</li>
                                <li><i class="bi bi-check text-success me-2"></i>Двухколоночный layout для удобства</li>
                                <li><i class="bi bi-check text-success me-2"></i>Счетчик символов для сообщения</li>
                                <li><i class="bi bi-check text-success me-2"></i>Кнопка очистки формы</li>
                                <li><i class="bi bi-check text-success me-2"></i>Валидация полей и сообщения об ошибках</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5 class="text-success">
                                <i class="bi bi-gear me-1"></i>
                                Техническая реализация
                            </h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-check text-success me-2"></i>AJAX загрузка списков сотрудников и проектов</li>
                                <li><i class="bi bi-check text-success me-2"></i>Автозаполнение через API endpoints</li>
                                <li><i class="bi bi-check text-success me-2"></i>Обработка ошибок и уведомления</li>
                                <li><i class="bi bi-check text-success me-2"></i>Интеграция с системой готовых шаблонов</li>
                                <li><i class="bi bi-check text-success me-2"></i>Поддержка всех полей из требований</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для отправки документа на подпись (копия из основной системы) -->
    <div class="modal fade" id="sendSignatureModal" tabindex="-1" aria-labelledby="sendSignatureModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sendSignatureModalLabel">
                        <i class="bi bi-send me-2"></i>
                        Отправить документ на подпись
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                </div>
                <form id="sendSignatureForm">
                    <div class="modal-body">
                        <!-- Скрытое поле для ID документа -->
                        <input type="hidden" id="documentId" name="document_id" value="">
                        
                        <!-- Информация о выбранном документе -->
                        <div id="documentInfo" class="alert alert-info mb-4" style="display: none;">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-file-earmark-text me-2"></i>
                                <div>
                                    <strong>Выбранный документ:</strong>
                                    <span id="selectedDocumentName"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Левая колонка - Основные данные -->
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="bi bi-person-check me-1"></i>
                                    Получатель и тип подписи
                                </h6>
                                
                                <!-- Выбор получателя -->
                                <div class="mb-3">
                                    <label for="recipientSelect" class="form-label">
                                        <i class="bi bi-people me-1"></i>
                                        Выберите получателя <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="recipientSelect" name="recipient_id" required>
                                        <option value="">Выберите сотрудника...</option>
                                        <option value="1">Иван Петров (ivan@rem-company.ru)</option>
                                        <option value="2">Мария Сидорова (maria@rem-company.ru)</option>
                                        <option value="3">Александр Козлов (alex@rem-company.ru)</option>
                                    </select>
                                    <div class="form-text">Выберите сотрудника для отправки документа на подпись</div>
                                </div>

                                <!-- Тип подписи -->
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="bi bi-shield-check me-1"></i>
                                        Тип электронной подписи
                                    </label>
                                    <div class="alert alert-info d-flex align-items-center p-2">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <div class="small">
                                            <strong>Простая ЭП</strong> - Подтверждение паролем (ФЗ-63)
                                        </div>
                                    </div>
                                    <input type="hidden" name="signature_type" value="simple">
                                </div>

                                <!-- Срок действия -->
                                <div class="mb-3">
                                    <label for="expiresAt" class="form-label">
                                        <i class="bi bi-calendar3 me-1"></i>
                                        Срок действия запроса
                                    </label>
                                    <input type="datetime-local" 
                                           class="form-control" 
                                           id="expiresAt" 
                                           name="expires_at">
                                    <div class="form-text">Оставьте пустым для срока 7 дней</div>
                                </div>
                            </div>

                            <!-- Правая колонка - Автозаполнение -->
                            <div class="col-md-6">
                                <h6 class="text-success mb-3">
                                    <i class="bi bi-magic me-1"></i>
                                    Автозаполнение данных
                                </h6>
                                
                                <!-- Выбор проекта для автозаполнения -->
                                <div class="mb-3">
                                    <label for="projectSelect" class="form-label">
                                        <i class="bi bi-building me-1"></i>
                                        Выберите проект
                                    </label>
                                    <select class="form-select" id="projectSelect" name="project_id">
                                        <option value="">-- Выберите проект --</option>
                                        <option value="1">Проект "Тверская, 10" - Иванов И.И.</option>
                                        <option value="2">Проект "Арбат, 25" - Петрова М.А.</option>
                                        <option value="3">Проект "Кутузовский, 5" - Сидоров А.В.</option>
                                    </select>
                                    <div class="form-text">Автоматически заполнит данные клиента и объекта</div>
                                </div>

                                <!-- Выбор сотрудника для автозаполнения -->
                                <div class="mb-3">
                                    <label for="employeeSelect" class="form-label">
                                        <i class="bi bi-person-badge me-1"></i>
                                        Выберите исполнителя
                                    </label>
                                    <select class="form-select" id="employeeSelect" name="employee_id">
                                        <option value="">-- Выберите сотрудника --</option>
                                        <option value="1">Иван Петров (Прораб)</option>
                                        <option value="2">Мария Сидорова (Инженер)</option>
                                        <option value="3">Александр Козлов (Мастер)</option>
                                    </select>
                                    <div class="form-text">Автоматически заполнит данные исполнителя</div>
                                </div>

                                <!-- Индикатор автозаполнения -->
                                <div id="autoFillStatus" class="alert alert-success d-none">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-check-circle me-2"></i>
                                        <div>
                                            <strong>Автозаполнение активно</strong>
                                            <div class="small" id="autoFillDetails"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Сообщение для получателя -->
                        <div class="mb-4">
                            <label for="signatureMessage" class="form-label">
                                <i class="bi bi-chat-text me-1"></i>
                                Сообщение для получателя
                            </label>
                            <textarea class="form-control" 
                                      id="signatureMessage" 
                                      name="message" 
                                      rows="4" 
                                      placeholder="Добавьте комментарий или инструкции для получателя..."
                                      maxlength="1000"></textarea>
                            <div class="form-text">
                                <span class="text-muted">Максимум 1000 символов</span>
                                <span id="messageCounter" class="float-end">0/1000</span>
                            </div>
                        </div>

                        <!-- Дополнительные поля автозаполнения -->
                        <div class="row" id="additionalFields">
                            <div class="col-md-6">
                                <h6 class="text-info mb-3">
                                    <i class="bi bi-person me-1"></i>
                                    Данные клиента
                                </h6>
                                
                                <div class="mb-3">
                                    <label for="clientName" class="form-label">ФИО клиента</label>
                                    <input type="text" class="form-control" id="clientName" name="client_name" placeholder="Будет заполнено автоматически">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="clientPhone" class="form-label">Телефон клиента</label>
                                    <input type="text" class="form-control" id="clientPhone" name="client_phone" placeholder="Будет заполнено автоматически">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="clientEmail" class="form-label">Email клиента</label>
                                    <input type="email" class="form-control" id="clientEmail" name="client_email" placeholder="Будет заполнено автоматически">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h6 class="text-info mb-3">
                                    <i class="bi bi-house me-1"></i>
                                    Данные объекта
                                </h6>
                                
                                <div class="mb-3">
                                    <label for="objectAddress" class="form-label">Адрес объекта</label>
                                    <textarea class="form-control" id="objectAddress" name="object_address" rows="2" placeholder="Будет заполнено автоматически"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="workType" class="form-label">Тип работ</label>
                                    <input type="text" class="form-control" id="workType" name="work_type" placeholder="Будет заполнено автоматически">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="contractNumber" class="form-label">Номер договора</label>
                                    <input type="text" class="form-control" id="contractNumber" name="contract_number" placeholder="Будет заполнено автоматически">
                                </div>
                            </div>
                        </div>

                        <!-- Данные исполнителя -->
                        <div class="row" id="executorFields">
                            <div class="col-md-6">
                                <h6 class="text-warning mb-3">
                                    <i class="bi bi-person-workspace me-1"></i>
                                    Данные исполнителя
                                </h6>
                                
                                <div class="mb-3">
                                    <label for="executorName" class="form-label">ФИО исполнителя</label>
                                    <input type="text" class="form-control" id="executorName" name="executor_name" placeholder="Будет заполнено при выборе сотрудника">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="executorPosition" class="form-label">Должность</label>
                                    <input type="text" class="form-control" id="executorPosition" name="executor_position" placeholder="Будет заполнено при выборе сотрудника">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h6 class="text-warning mb-3">
                                    <i class="bi bi-telephone me-1"></i>
                                    Контактные данные
                                </h6>
                                
                                <div class="mb-3">
                                    <label for="executorPhone" class="form-label">Телефон исполнителя</label>
                                    <input type="text" class="form-control" id="executorPhone" name="executor_phone" placeholder="Будет заполнено при выборе сотрудника">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="executorEmail" class="form-label">Email исполнителя</label>
                                    <input type="email" class="form-control" id="executorEmail" name="executor_email" placeholder="Будет заполнено при выборе сотрудника">
                                </div>
                            </div>
                        </div>

                        <!-- Предупреждение о юридической силе -->
                        <div class="alert alert-warning d-flex align-items-start">
                            <i class="bi bi-exclamation-triangle me-2 mt-1"></i>
                            <div>
                                <strong>Важно!</strong>
                                <p class="mb-0 small">
                                    Простая электронная подпись в соответствии с ФЗ-63 "Об электронной подписи" 
                                    имеет юридическую силу при условии соблюдения установленных требований безопасности.
                                    Документ, подписанный простой ЭП, равнозначен документу на бумажном носителе.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>
                            Отмена
                        </button>
                        <button type="button" class="btn btn-outline-primary" id="clearFormBtn">
                            <i class="bi bi-arrow-clockwise me-1"></i>
                            Очистить форму
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send me-1"></i>
                            Отправить на подпись
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Функция для открытия модального окна с заданным документом
        function openSignatureModalForDocument(documentId, documentName) {
            // Устанавливаем данные документа
            document.getElementById('documentId').value = documentId;
            document.getElementById('selectedDocumentName').textContent = documentName;
            document.getElementById('documentInfo').style.display = 'block';
            
            // Открываем модальное окно
            const modal = new bootstrap.Modal(document.getElementById('sendSignatureModal'));
            modal.show();
        }

        // Демонстрация автозаполнения при выборе проекта
        document.getElementById('projectSelect').addEventListener('change', function() {
            const projectId = this.value;
            if (projectId) {
                simulateProjectAutofill(projectId);
            } else {
                clearProjectData();
            }
        });

        // Демонстрация автозаполнения при выборе сотрудника
        document.getElementById('employeeSelect').addEventListener('change', function() {
            const employeeId = this.value;
            if (employeeId) {
                simulateEmployeeAutofill(employeeId);
            } else {
                clearEmployeeData();
            }
        });

        // Симуляция автозаполнения данных проекта
        function simulateProjectAutofill(projectId) {
            const projects = {
                '1': {
                    clientName: 'Иванов Иван Иванович',
                    clientPhone: '+7 (915) 123-45-67',
                    clientEmail: 'ivanov@email.ru',
                    objectAddress: 'г. Москва, ул. Тверская, д. 10, кв. 15',
                    workType: 'Ремонт квартиры',
                    contractNumber: 'РК-2025-001'
                },
                '2': {
                    clientName: 'Петрова Мария Александровна',
                    clientPhone: '+7 (916) 234-56-78',
                    clientEmail: 'petrova@email.ru',
                    objectAddress: 'г. Москва, ул. Арбат, д. 25, кв. 8',
                    workType: 'Евроремонт',
                    contractNumber: 'ЕР-2025-002'
                },
                '3': {
                    clientName: 'Сидоров Александр Васильевич',
                    clientPhone: '+7 (917) 345-67-89',
                    clientEmail: 'sidorov@email.ru',
                    objectAddress: 'г. Москва, Кутузовский пр-т, д. 5, кв. 120',
                    workType: 'Дизайнерский ремонт',
                    contractNumber: 'ДР-2025-003'
                }
            };

            const project = projects[projectId];
            if (project) {
                fillAndHighlightField('clientName', project.clientName);
                fillAndHighlightField('clientPhone', project.clientPhone);
                fillAndHighlightField('clientEmail', project.clientEmail);
                fillAndHighlightField('objectAddress', project.objectAddress);
                fillAndHighlightField('workType', project.workType);
                fillAndHighlightField('contractNumber', project.contractNumber);

                // Автозаполнение сообщения
                const messageField = document.getElementById('signatureMessage');
                const autoMessage = `Пожалуйста, подпишите документ по проекту: ${project.workType}
Адрес объекта: ${project.objectAddress}
Клиент: ${project.clientName}

С уважением,
Команда проекта`;
                
                messageField.value = autoMessage;
                updateMessageCounter();

                showAutoFillStatus('project', `${project.workType} - ${project.clientName}`);
            }
        }

        // Симуляция автозаполнения данных сотрудника
        function simulateEmployeeAutofill(employeeId) {
            const employees = {
                '1': {
                    name: 'Иван Петров',
                    position: 'Прораб',
                    phone: '+7 (495) 123-45-67',
                    email: 'petrov@rem-company.ru'
                },
                '2': {
                    name: 'Мария Сидорова',
                    position: 'Инженер',
                    phone: '+7 (495) 234-56-78',
                    email: 'sidorova@rem-company.ru'
                },
                '3': {
                    name: 'Александр Козлов',
                    position: 'Мастер участка',
                    phone: '+7 (495) 345-67-89',
                    email: 'kozlov@rem-company.ru'
                }
            };

            const employee = employees[employeeId];
            if (employee) {
                fillAndHighlightField('executorName', employee.name, 'warning');
                fillAndHighlightField('executorPosition', employee.position, 'warning');
                fillAndHighlightField('executorPhone', employee.phone, 'warning');
                fillAndHighlightField('executorEmail', employee.email, 'warning');

                showAutoFillStatus('employee', `${employee.name} (${employee.position})`);
            }
        }

        // Функция заполнения и подсветки поля
        function fillAndHighlightField(fieldId, value, type = 'success') {
            const field = document.getElementById(fieldId);
            if (field && value) {
                field.value = value;
                field.classList.add('bg-light', `border-${type}`);
                field.style.transition = 'all 0.3s ease';
                
                setTimeout(() => {
                    field.classList.remove('bg-light');
                }, 2000);
            }
        }

        // Показать статус автозаполнения
        function showAutoFillStatus(type, name) {
            const statusDiv = document.getElementById('autoFillStatus');
            const detailsDiv = document.getElementById('autoFillDetails');
            
            if (statusDiv && detailsDiv) {
                const typeText = type === 'project' ? 'проекта' : type === 'employee' ? 'сотрудника' : type;
                detailsDiv.textContent = `Загружены данные ${typeText}: ${name}`;
                statusDiv.classList.remove('d-none');
            }
        }

        // Очистить данные проекта
        function clearProjectData() {
            ['clientName', 'clientPhone', 'clientEmail', 'objectAddress', 'workType', 'contractNumber'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = '';
                    field.classList.remove('bg-light', 'border-success', 'border-warning');
                }
            });
        }

        // Очистить данные сотрудника
        function clearEmployeeData() {
            ['executorName', 'executorPosition', 'executorPhone', 'executorEmail'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = '';
                    field.classList.remove('bg-light', 'border-success', 'border-warning');
                }
            });
        }

        // Очистить статус автозаполнения
        function clearAutoFillStatus() {
            const statusDiv = document.getElementById('autoFillStatus');
            if (statusDiv) {
                statusDiv.classList.add('d-none');
            }
        }

        // Счетчик символов для сообщения
        function updateMessageCounter() {
            const messageTextarea = document.getElementById('signatureMessage');
            const messageCounter = document.getElementById('messageCounter');
            
            if (messageTextarea && messageCounter) {
                const length = messageTextarea.value.length;
                messageCounter.textContent = `${length}/1000`;
                
                if (length > 950) {
                    messageCounter.classList.add('text-warning');
                    messageCounter.classList.remove('text-danger');
                } else if (length > 1000) {
                    messageCounter.classList.remove('text-warning');
                    messageCounter.classList.add('text-danger');
                } else {
                    messageCounter.classList.remove('text-warning', 'text-danger');
                }
            }
        }

        // Инициализация обработчиков
        document.addEventListener('DOMContentLoaded', function() {
            // Устанавливаем минимальную дату (сейчас + 1 час)
            const now = new Date();
            now.setHours(now.getHours() + 1);
            document.getElementById('expiresAt').min = now.toISOString().slice(0, 16);

            // Счетчик символов
            const messageTextarea = document.getElementById('signatureMessage');
            if (messageTextarea) {
                messageTextarea.addEventListener('input', updateMessageCounter);
            }

            // Обработчик очистки формы
            document.getElementById('clearFormBtn').addEventListener('click', function() {
                clearForm();
            });

            // Обработчик отправки формы
            document.getElementById('sendSignatureForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('В демо-режиме отправка не выполняется.\nВ реальной системе здесь произойдет отправка запроса на подпись.');
            });
        });

        // Очистить всю форму
        function clearForm() {
            const form = document.getElementById('sendSignatureForm');
            form.reset();
            
            document.getElementById('projectSelect').selectedIndex = 0;
            document.getElementById('employeeSelect').selectedIndex = 0;
            
            clearProjectData();
            clearEmployeeData();
            clearAutoFillStatus();
            
            updateMessageCounter();
            
            alert('Форма очищена');
        }

        // Демо функция для шаблонов (заглушка)
        function useTemplate(templateType) {
            alert(`В демо-режиме создание документа из шаблона "${templateType}" не выполняется.\nВ реальной системе здесь откроется модальное окно создания документа из шаблона.`);
        }
    </script>
</body>
</html>
