<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –ø—Ä–æ–µ–∫—Ç–æ–≤</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h1>–¢–µ—Å—Ç API –ø—Ä–æ–µ–∫—Ç–æ–≤</h1>
    
    <div class="row">
        <div class="col-md-6">
            <h3>–¢–µ—Å—Ç API endpoints</h3>
            <!-- –£–¥–∞–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
            
            <div id="results" class="mt-3">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            </div>
        </div>
        
        <div class="col-md-6">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
            <div id="output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto;">
                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...
            </div>
        </div>
    </div>

    <script>
        function testProjectsAPI() {
            logOutput('–¢–µ—Å—Ç–∏—Ä—É–µ–º /api/document-templates/projects...');
            
            fetch('/api/document-templates/projects', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                logOutput(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        logOutput(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${e.message}`);
                        logOutput(`–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: ${text}`);
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π JSON');
                    }
                });
            })
            .then(data => {
                logOutput('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:');
                logOutput(JSON.stringify(data, null, 2));
                
                if (data.success && data.projects) {
                    logOutput(`üìä –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: ${data.projects.length}`);
                    data.projects.forEach((project, index) => {
                        logOutput(`${index + 1}. ${project.client_full_name || project.name} - ${project.work_type || '–ü—Ä–æ–µ–∫—Ç'}`);
                    });
                }
            })
            .catch(error => {
                logOutput(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                console.error('Error:', error);
            });
        }
        
        function testEmployeesAPI() {
            logOutput('–¢–µ—Å—Ç–∏—Ä—É–µ–º /api/partner/document-templates/employees...');
            
            fetch('/api/partner/document-templates/employees', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                logOutput(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        logOutput(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${e.message}`);
                        logOutput(`–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: ${text}`);
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π JSON');
                    }
                });
            })
            .then(data => {
                logOutput('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:');
                logOutput(JSON.stringify(data, null, 2));
                
                if (data.employees) {
                    logOutput(`üë• –ù–∞–π–¥–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${data.employees.length}`);
                    data.employees.forEach((employee, index) => {
                        logOutput(`${index + 1}. ${employee.name} (ID: ${employee.id})`);
                    });
                }
            })
            .catch(error => {
                logOutput(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                console.error('Error:', error);
            });
        }
        
        function logOutput(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
    </script>
</body>
</html>
