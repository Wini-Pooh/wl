# План оптимизации модальных окон и валидации

## 1. Анализ текущего состояния

### Модальные окна:
- ✅ work-modal.blade.php - базовые поля
- ✅ material-modal.blade.php - базовые поля  
- ✅ transport-modal.blade.php - базовые поля
- ✅ document-modal.blade.php - загрузка файлов
- ⚠️ Отсутствуют поля `paid_amount`, `payment_date`, `type` для работ и материалов

### Валидация в контроллерах:
- ✅ ProjectFinanceController - полная валидация
- ✅ ProjectDocumentController - валидация файлов
- ⚠️ Контроллеры ожидают больше полей, чем отправляют формы

## 2. Проблемы для исправления

### 2.1 Несоответствие полей формы и валидации
**Work Modal:**
- Отсутствует: `type`, `paid_amount`, `payment_date`
- Валидация ожидает: все эти поля

**Material Modal:**  
- Отсутствует: `type`, `paid_amount`, `payment_date`
- Валидация ожидает: все эти поля

**Transport Modal:**
- Отсутствует: `paid_amount`, `payment_date` 
- Валидация ожидает: эти поля

### 2.2 Маски ввода
- ✅ Цена: `price-mask`, `data-mask="currency"`
- ✅ Количество: `quantity-mask`, `data-mask="decimal"`
- ⚠️ Нужно проверить реализацию масок в JavaScript
- ⚠️ Добавить маски для дат и телефонов (если есть)

### 2.3 Дополнительные поля для финансового учета
- `paid_amount` - оплаченная сумма (nullable)
- `payment_date` - дата оплаты (nullable) 
- `type` - тип (basic/additional) для работ и материалов

## 3. План исправлений

### Этап 1: Обновление модальных окон
1. Добавить недостающие поля в work-modal.blade.php
2. Добавить недостающие поля в material-modal.blade.php  
3. Добавить недостающие поля в transport-modal.blade.php
4. Реализовать правильные маски для всех полей

### Этап 2: Проверка и улучшение валидации
1. Убедиться, что все поля в контроллерах соответствуют формам
2. Добавить валидацию на стороне клиента (JavaScript)
3. Улучшить сообщения об ошибках

### Этап 3: Тестирование
1. Проверить все CRUD операции
2. Проверить валидацию на клиенте и сервере
3. Проверить маски ввода

## 4. Рекомендуемые улучшения

### 4.1 Маски ввода
```javascript
// Цена - только цифры и запятая/точка для десятичных
price-mask: /^\d+([.,]\d{0,2})?$/

// Количество - цифры и запятая/точка
quantity-mask: /^\d+([.,]\d{0,3})?$/

// Дата - dd.mm.yyyy
date-mask: /^\d{2}\.\d{2}\.\d{4}$/
```

### 4.2 Валидация на клиенте
- Проверка обязательных полей
- Проверка корректности цен и количества
- Проверка дат
- Немедленная обратная связь пользователю

### 4.3 UX улучшения  
- Автоматический расчет общей стоимости
- Подсказки для заполнения полей
- Сохранение прогресса при переключении между полями
